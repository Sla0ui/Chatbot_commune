<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Assistant virtuel de la Commune de F√®s - Services administratifs et informations municipales">
    <meta name="robots" content="index, follow">
    <title>Chatbot - Commune de F√®s</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNCIgZmlsbD0iIzY2N2VlYSIvPgo8dGV4dCB4PSI1IiB5PSIyMiIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBmaWxsPSJ3aGl0ZSI+QzwvdGV4dD4KPC9zdmc+">
</head>

<body>
    <!-- ===== MAIN CHAT CONTAINER ===== -->
    <div class="chat-container">
        <!-- ===== CHAT HEADER ===== -->
        <div class="chat-header">
            <span>Chatbot - Commune de F√®s</span>
            <div style="display: flex; align-items: center; gap: 10px; margin-left: auto;">
                <form method="POST" action="{{ url_for('clear_chat') }}" style="margin: 0;">
                    <input type="hidden" name="session_id" value="{{ session_id }}">
                    <button type="submit" 
                            style="background: none; border: none; color: #fff; font-size: 1.1em; cursor: pointer; padding: 0 8px;" 
                            title="Effacer l'historique" aria-label="Effacer l'historique">
                        üóëÔ∏è
                    </button>
                </form>
                
                <form method="POST" action="{{ url_for('toggle_font_size') }}" style="margin: 0;">
                    <input type="hidden" name="session_id" value="{{ session_id }}">
                    <button type="submit" 
                            style="background: none; border: none; color: #fff; font-size: 1.2em; cursor: pointer; padding: 0 8px;" 
                            title="{{ font_size_tooltip }}" aria-label="Changer la taille de police">
                        {{ font_size_icon }}
                    </button>
                </form>
                
                <form method="POST" action="{{ url_for('toggle_theme') }}" style="margin: 0;">
                    <input type="hidden" name="session_id" value="{{ session_id }}">
                    <button type="submit" 
                            style="background: none; border: none; color: #fff; font-size: 1.2em; cursor: pointer; padding: 0 8px;" 
                            title="Changer le th√®me" aria-label="Changer le th√®me">
                        {{ theme_icon }}
                    </button>
                </form>
                
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/56/Commune_de_F%C3%A9s.png" 
                     alt="Logo Commune de F√®s" 
                     style="height: 36px; width: auto; background: #fff; border-radius: 6px; padding: 2px; box-shadow: 0 1px 4px rgba(0,0,0,0.08);" />
            </div>
        </div>
        
        <!-- ===== CHAT MESSAGES AREA ===== -->
        <div class="chat-messages" id="chatMessages">
            {% for message in chat_history %}
                <div class="message {{ message.sender }}">
                    {{ message.text | safe }}
                </div>
            {% endfor %}
        </div>
        
        <!-- ===== QUICK REPLY BUTTONS ===== -->
        {% if not in_conversation %}
        <div class="quick-replies">
            <form method="POST" action="{{ url_for('chat') }}" style="display: inline;">
                <input type="hidden" name="session_id" value="{{ session_id }}">
                <button type="submit" name="question" value="Horaires d'ouverture" class="quick-reply-btn">Horaires</button>
                <button type="submit" name="question" value="Adresse de la mairie" class="quick-reply-btn">Adresse</button>
                <button type="submit" name="question" value="Certificat de r√©sidence" class="quick-reply-btn">Certificat r√©sidence</button>
                <button type="submit" name="question" value="Acte de naissance" class="quick-reply-btn">Acte naissance</button>
                <button type="submit" name="question" value="Carte d'identit√© nationale" class="quick-reply-btn">CNI</button>
                <button type="submit" name="question" value="Passeport" class="quick-reply-btn">Passeport</button>
            </form>
        </div>
        {% else %}
        <div class="conversation-replies">
            <form method="POST" action="{{ url_for('chat') }}" style="display: inline;">
                <input type="hidden" name="session_id" value="{{ session_id }}">
                {% for button in conversation_buttons %}
                    <button type="submit" name="question" value="{{ button.value }}" class="quick-reply-btn">{{ button.text }}</button>
                {% endfor %}
            </form>
        </div>
        {% endif %}
        
        <!-- ===== CHAT INPUT FORM ===== -->
        <form class="chat-input" method="POST" action="{{ url_for('chat') }}">
            <input type="hidden" name="session_id" value="{{ session_id }}">
            <input type="text" name="question" placeholder="√âcrivez votre question..." autocomplete="off" required />
            <button type="submit">Envoyer</button>
        </form>
    </div>

    <script>
        // Apply theme and font size from server-side preferences
        document.addEventListener('DOMContentLoaded', function() {
            // Get user preferences from server (these would be passed as template variables)
            // For now, we'll use the default dark theme and normal font size
            // In a real implementation, these would be passed from Flask
            
            // Apply theme class if needed
            const theme = '{{ theme }}' || 'dark';
            if (theme === 'light') {
                document.body.classList.add('light-theme');
            }
            
            // Apply font size
            const fontSize = '{{ font_size }}' || 'normal';
            if (fontSize !== 'normal') {
                document.body.setAttribute('data-font-size', fontSize);
            }
            
            // Auto-scroll to bottom of chat messages with a small delay to prevent jumping
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                setTimeout(() => {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 100);
            }
        });
    </script>
</body>
</html> 